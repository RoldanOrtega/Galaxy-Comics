<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pedidos Personalizados - Galaxy Comics</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Comic+Neue:wght@400;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

<!-- ===== ENCABEZADO ===== -->
<header style="background: none; position: relative; overflow: hidden;">
  <img src="img/banner-fondo.png" alt="Fondo tipo c√≥mic"
       style="position:absolute; top:0; left:0; width:100%; height:100%; object-fit:cover; z-index:-1;">
  <img src="img/logo.png" alt="Logo Galaxy Comics" class="logo">
  <h1>GALAXY COMICS</h1>
  
  <!-- CONTENEDOR PARA USUARIO LOGUEADO -->
  <div style="display: flex; align-items: center; gap: 15px;">
    <span id="nombreUsuarioHeader" style="display: none; font-family: 'Poppins', sans-serif; font-weight: bold; color: white; font-size: 16px; background: rgba(255, 59, 59, 0.8); padding: 8px 15px; border-radius: 20px; box-shadow: 0 3px 10px rgba(0,0,0,0.2);">
      <!-- Aqu√≠ aparecer√° el nombre del usuario -->
    </span>
    
    <a id="usuarioLink" href="#">
      <img id="iconoUsuario" src="img/btn-login.png" alt="Iniciar sesi√≥n" class="btn-login">
    </a>
    
    <!-- CONTADOR DE CARRITO -->
    <a href="carrito.html" style="position: relative; text-decoration: none;">
      <i class="fas fa-shopping-cart" style="font-size: 24px; color: white;"></i>
      <span id="carritoContador" class="carrito-contador" style="display: none; position: absolute; top: -8px; right: -8px; background: #ff3b3b; color: white; border-radius: 50%; width: 20px; height: 20px; font-size: 12px; display: flex; align-items: center; justify-content: center; font-weight: bold;">
        0
      </span>
    </a>
  </div>
</header>

  <!-- ===== BARRA DE NAVEGACI√ìN ===== -->
  <nav>
    <img src="img/nav-bar.png" alt="Barra de navegaci√≥n" class="nav-bg">
    <ul>
      <li><a href="index.html">Inicio</a></li>
      <li><a href="Comics.html">C√≥mics</a></li>
      <li><a href="Coleccion.html">Coleccionables</a></li>
      <li><a href="Autores.html">Autores</a></li>
      <li><a href="Pedidos.html" class="active-nav">Pedidos Personalizados</a></li>
      <li><a href="carrito.html">üõí Carrito <span id="navCarritoContador" class="carrito-contador" style="display: none; background: #ff3b3b; color: white; padding: 2px 8px; border-radius: 10px; font-size: 12px; margin-left: 5px;">0</span></a></li>
      <li><a href="historialPedidos.html">üì¶ Mis Pedidos</a></li>
    </ul>
  </nav>

  <!-- ===== CONTENIDO PRINCIPAL (CLIENTE O ADMIN) ===== -->
  <div id="contenidoPrincipal">
    <!-- Este div se llenar√° din√°micamente seg√∫n el tipo de usuario -->
  </div>

<!-- ===== PERFIL FLOTANTE ===== -->
<div id="perfilBox" class="perfil-box">
  <div class="perfil-contenido">
    <h2>üë§ Perfil</h2>
    <p><strong>Usuario:</strong> <span id="perfilUsuario"></span></p>
    <p><strong>Nombre:</strong> <span id="perfilNombre"></span></p>
    <p><strong>Fecha de nacimiento:</strong> <span id="perfilFecha"></span></p>
    <p><strong>Correo:</strong> <span id="perfilCorreo"></span></p>
    <p><strong>Pedidos realizados:</strong> <span id="perfilPedidos">0</span></p>
    <p><strong>Productos en carrito:</strong> <span id="perfilCarrito">0</span></p>
    <button id="cerrarSesion">Cerrar Sesi√≥n</button>
  </div>
</div>

  <!-- ===== SCRIPTS ===== -->
  <script src="script.js"></script>
  <script src="funcionesUsuario.js"></script>
  
  <script>
    // Variables globales
    let esAdmin = false;
    let pedidosDB = JSON.parse(localStorage.getItem("pedidosGlobales")) || [];
    let modalActual = null;
    
    // Lista de personajes disponibles
    const personajesDisponibles = [
        "Spider-Man", "Batman", "Superman", "Wonder Woman", "Iron Man", 
        "Hulk", "Thor", "Flash", "Wolverine", "Capitan Am√©rica",
        "Aquaman", "Black Widow", "Doctor Strange", "Deadpool", "Harley Quinn",
        "Personaje original (descr√≠belo abajo)"
    ];

    document.addEventListener('DOMContentLoaded', function() {
      console.log("DOM cargado - Inicializando Pedidos.html");
      
      verificarSesion();
      actualizarContadorCarrito();
      
      // Verificar si es administrador
      verificarAdmin();
      
      // Cargar contenido seg√∫n tipo de usuario
      cargarContenidoUsuario();
      
      console.log("Pedidos.html inicializado correctamente");
    });

    // Verificar si el usuario es administrador
    function verificarAdmin() {
      const usuarioActual = JSON.parse(localStorage.getItem("usuarioActual"));
      esAdmin = usuarioActual && usuarioActual.usuario === "admin" && usuarioActual.password === "admin123";
      
      if (esAdmin) {
        // Agregar badge de ADMIN al nombre de usuario
        const nombreUsuarioHeader = document.getElementById("nombreUsuarioHeader");
        if (nombreUsuarioHeader) {
          const textoOriginal = nombreUsuarioHeader.textContent;
          nombreUsuarioHeader.innerHTML = textoOriginal + ' <span style="background: #ff3b3b; color: white; padding: 2px 8px; border-radius: 10px; font-size: 12px; margin-left: 5px;">ADMIN</span>';
        }
      }
    }

    // Cargar contenido seg√∫n tipo de usuario
    function cargarContenidoUsuario() {
      const usuario = obtenerUsuarioActual();
      const contenidoPrincipal = document.getElementById('contenidoPrincipal');
      
      if (!usuario) {
        // Usuario no logueado - mostrar formulario con advertencia
        contenidoPrincipal.innerHTML = crearHTMLCliente();
        configurarFormularioCliente();
      } else if (esAdmin) {
        // Usuario es administrador - mostrar tabla de administraci√≥n
        contenidoPrincipal.innerHTML = crearHTMLAdmin();
        cargarTablaPedidos();
        configurarEventosAdmin();
      } else {
        // Usuario normal logueado - mostrar formulario normal
        contenidoPrincipal.innerHTML = crearHTMLCliente();
        configurarFormularioCliente();
      }
    }

    // ===== HTML PARA CLIENTES =====
    function crearHTMLCliente() {
      return `
        <!-- ===== HERO SECTION (PEDIDOS PERSONALIZADOS) ===== -->
        <section class="hero-section">
          <div class="hero-content">
            <h1 class="hero-title">üé® PEDIDOS PERSONALIZADOS</h1>
            <p class="hero-subtitle">
              ¬øSue√±as con un c√≥mic √∫nico? ¬°Lo hacemos realidad! Dise√±amos c√≥mics personalizados seg√∫n tus ideas. 
              Elige el personaje, estilo y formato, y nosotros creamos una historia √∫nica para ti.
            </p>
            
            <div class="process-steps">
              <div class="step">
                <div class="step-number">1</div>
                <h3 class="step-title">Completa el formulario</h3>
                <p class="step-description">Con tus ideas y especificaciones detalladas</p>
              </div>
              
              <div class="step">
                <div class="step-number">2</div>
                <h3 class="step-title">Contacto personalizado</h3>
                <p class="step-description">Te contactamos para discutir todos los detalles</p>
              </div>
              
              <div class="step">
                <div class="step-number">3</div>
                <h3 class="step-title">Aprobaci√≥n del dise√±o</h3>
                <p class="step-description">Revisamos y aprobamos el dise√±o juntos</p>
              </div>
              
              <div class="step">
                <div class="step-number">4</div>
                <h3 class="step-title">¬°Recibe tu c√≥mic!</h3>
                <p class="step-description">Entregamos tu c√≥mic √∫nico y personalizado</p>
              </div>
            </div>
          </div>
        </section>

        <!-- ===== ESPECIFICACIONES + EJEMPLOS ===== -->
        <div class="specifications-container">
          <!-- FORMULARIO DE ESPECIFICACIONES -->
          <div class="form-container">
            <h2 class="form-title">üìù CREA TU C√ìMIC PERSONALIZADO</h2>
            
            <form id="formularioPedido">
              <!-- Tipo de C√≥mic -->
              <div class="form-group">
                <label for="tipoComic" class="form-label">
                  <i class="fas fa-book"></i> Tipo de C√≥mic:
                </label>
                <select id="tipoComic" name="tipoComic" required class="form-select">
                  <option value="">Selecciona un tipo</option>
                  <option value="portada">Portada Personalizada</option>
                  <option value="historieta">Historieta Corta (5-10 p√°ginas)</option>
                  <option value="novela">Novela Gr√°fica (20+ p√°ginas)</option>
                </select>
              </div>

              <!-- Personaje -->
              <div class="form-group">
                <label for="personaje" class="form-label">
                  <i class="fas fa-user"></i> Personaje Principal:
                </label>
                <select id="personaje" name="personaje" required class="form-select">
                  <option value="">Selecciona un personaje</option>
                </select>
              </div>

              <!-- Estilo -->
              <div class="form-group">
                <label for="estilo" class="form-label">
                  <i class="fas fa-paint-brush"></i> Estilo de Arte:
                </label>
                <select id="estilo" name="estilo" required class="form-select">
                  <option value="">Selecciona un estilo</option>
                  <option value="clasico">Cl√°sico (C√≥mics tradicional)</option>
                  <option value="moderno">Moderno (Estilo actual)</option>
                  <option value="manga">Manga/Anime</option>
                  <option value="realista">Realista</option>
                  <option value="cartoon">Cartoon/Animado</option>
                </select>
              </div>

              <!-- Formato -->
              <div class="form-group">
                <label for="formato" class="form-label">
                  <i class="fas fa-print"></i> Formato:
                </label>
                <select id="formato" name="formato" required class="form-select">
                  <option value="">Selecciona un formato</option>
                  <option value="digital">Digital (PDF)</option>
                  <option value="fisico">F√≠sico Est√°ndar</option>
                  <option value="premium">F√≠sico Premium (Tapa dura, papel especial)</option>
                </select>
              </div>

              <!-- Cantidad -->
              <div class="form-group">
                <label for="cantidad" class="form-label">
                  <i class="fas fa-copy"></i> Cantidad:
                </label>
                <input type="number" id="cantidad" name="cantidad" min="1" max="10" value="1" required class="form-input">
              </div>

              <!-- Fecha de Entrega -->
              <div class="form-group">
                <label for="fechaEntrega" class="form-label">
                  <i class="fas fa-calendar-alt"></i> Fecha deseada de entrega:
                </label>
                <input type="date" id="fechaEntrega" name="fechaEntrega" required class="form-input">
              </div>

              <!-- Descripci√≥n -->
              <div class="form-group">
                <label for="descripcion" class="form-label">
                  <i class="fas fa-edit"></i> Descripci√≥n de tu idea:
                </label>
                <textarea id="descripcion" name="descripcion" 
                          placeholder="Describe tu idea para el c√≥mic: historia, personajes, escenas importantes, etc."
                          required class="form-textarea"></textarea>
              </div>

              <!-- Precio Estimado -->
              <div class="price-box">
                <h3 class="price-title">PRECIO ESTIMADO</h3>
                <p class="price-amount" id="precioTotal">$100</p>
                <p class="price-note">
                  <i class="fas fa-info-circle"></i> El precio final puede variar seg√∫n la complejidad del dise√±o
                </p>
              </div>

              <!-- Bot√≥n Enviar -->
              <button type="submit" class="submit-button">
                üöÄ ENVIAR SOLICITUD DE PEDIDO
              </button>
              
              <!-- Mensaje de advertencia login -->
              <div id="loginWarning" class="login-warning" style="display: none;">
                <p class="warning-text">
                  <i class="fas fa-exclamation-triangle"></i> Debes 
                  <a href="login.html" class="warning-link">iniciar sesi√≥n</a> 
                  para realizar un pedido personalizado.
                </p>
              </div>
            </form>
          </div>

          <!-- EJEMPLOS EN SIDEBAR -->
          <div class="examples-sidebar">
            <div class="example-card">
              <img src="img/pedido1.png" alt="Pedido Custom Spider-Man" class="example-image">
              <div class="example-content">
                <h3 class="example-title">Spider-Man Personalizado</h3>
                <p class="example-description">Dise√±o exclusivo de Spider-Man con colores personalizados y portada √∫nica seg√∫n pedido del cliente.</p>
              </div>
            </div>

            <div class="example-card">
              <img src="img/pedido2.png" alt="Pedido Batman Deluxe" class="example-image">
              <div class="example-content">
                <h3 class="example-title">Batman Deluxe</h3>
                <p class="example-description">Edici√≥n limitada de Batman con arte alternativo y detalles en relieve, creada para coleccionistas.</p>
              </div>
            </div>
            
            <div class="example-card">
              <img src="img/pedido3.png" alt="Pedido Superman Retro" class="example-image">
              <div class="example-content">
                <h3 class="example-title">Superman Retro</h3>
                <p class="example-description">Portada retro de Superman, restaurada y adaptada con elementos personalizados elegidos por el cliente.</p>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    // ===== HTML PARA ADMINISTRADOR =====
    function crearHTMLAdmin() {
      return `
        <!-- ===== HERO SECTION ADMIN ===== -->
        <section class="hero-section">
          <div class="hero-content">
            <h1 class="hero-title">üëë ADMINISTRACI√ìN DE PEDIDOS PERSONALIZADOS</h1>
            <p class="hero-subtitle">
              Panel de administraci√≥n para gestionar todos los pedidos personalizados realizados por los clientes.
              Puedes ver detalles, actualizar estados y contactar a los clientes.
            </p>
            
            <div class="process-steps">
              <div class="step">
                <div class="step-number">1</div>
                <h3 class="step-title">Ver todos los pedidos</h3>
                <p class="step-description">Revisa todos los pedidos personalizados pendientes y completados</p>
              </div>
              
              <div class="step">
                <div class="step-number">2</div>
                <h3 class="step-title">Actualizar estados</h3>
                <p class="step-description">Cambia el estado de los pedidos seg√∫n avancen en el proceso</p>
              </div>
              
              <div class="step">
                <div class="step-number">3</div>
                <h3 class="step-title">Contactar clientes</h3>
                <p class="step-description">Coordina detalles directamente con los clientes</p>
              </div>
              
              <div class="step">
                <div class="step-number">4</div>
                <h3 class="step-title">Gestionar producci√≥n</h3>
                <p class="step-description">Supervisa el proceso de creaci√≥n de los c√≥mics personalizados</p>
              </div>
            </div>
          </div>
        </section>

        <!-- ===== ESTAD√çSTICAS ADMIN ===== -->
        <div class="contenedor-principal" style="margin-top: 20px;">
          <div style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); padding: 20px 30px; border-radius: 15px; border: 3px solid #ff3b3b; box-shadow: 0 10px 30px rgba(0,0,0,0.3); margin-bottom: 30px;">
            <h3 style="color: white; margin: 0 0 20px 0; font-family: 'Bangers', cursive; font-size: 26px; display: flex; align-items: center; gap: 15px;">
              <i class="fas fa-chart-bar"></i> ESTAD√çSTICAS DE PEDIDOS
            </h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
              <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; text-align: center; border: 2px solid rgba(255,255,255,0.2);">
                <h4 style="color: #ff3b3b; margin: 0 0 10px 0; font-family: 'Bangers', cursive; font-size: 32px;" id="totalPedidos">0</h4>
                <p style="color: #ddd; margin: 0; font-family: 'Poppins', sans-serif; font-size: 14px;">Total Pedidos</p>
              </div>
              <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; text-align: center; border: 2px solid rgba(255,255,255,0.2);">
                <h4 style="color: #ff9800; margin: 0 0 10px 0; font-family: 'Bangers', cursive; font-size: 32px;" id="pedidosPendientes">0</h4>
                <p style="color: #ddd; margin: 0; font-family: 'Poppins', sans-serif; font-size: 14px;">Pendientes</p>
              </div>
              <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; text-align: center; border: 2px solid rgba(255,255,255,0.2);">
                <h4 style="color: #4CAF50; margin: 0 0 10px 0; font-family: 'Bangers', cursive; font-size: 32px;" id="pedidosCompletados">0</h4>
                <p style="color: #ddd; margin: 0; font-family: 'Poppins', sans-serif; font-size: 14px;">Completados</p>
              </div>
              <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; text-align: center; border: 2px solid rgba(255,255,255,0.2);">
                <h4 style="color: #2196F3; margin: 0 0 10px 0; font-family: 'Bangers', cursive; font-size: 32px;" id="ingresoTotal">$0</h4>
                <p style="color: #ddd; margin: 0; font-family: 'Poppins', sans-serif; font-size: 14px;">Ingreso Total</p>
              </div>
            </div>
          </div>
        </div>

        <!-- ===== FILTROS Y CONTROLES ADMIN ===== -->
        <div class="contenedor-principal">
          <div style="background: #f8f8f8; padding: 20px; border-radius: 15px; border: 2px solid #ddd; margin-bottom: 20px;">
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
              <h3 style="margin: 0; color: #1a1a2e; font-family: 'Poppins', sans-serif; font-size: 20px; display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-filter"></i> Filtros
              </h3>
              
              <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <button id="btnExportarPedidos" style="padding: 10px 20px; background: #9C27B0; color: white; border: none; border-radius: 8px; font-family: 'Poppins', sans-serif; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: all 0.3s ease;">
                  <i class="fas fa-download"></i> Exportar
                </button>
                <button id="btnActualizarPedidos" style="padding: 10px 20px; background: #2196F3; color: white; border: none; border-radius: 8px; font-family: 'Poppins', sans-serif; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: all 0.3s ease;">
                  <i class="fas fa-sync"></i> Actualizar
                </button>
              </div>
            </div>
            
            <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 15px;">
              <select id="filtroEstado" style="padding: 10px 15px; border: 2px solid #ddd; border-radius: 8px; font-family: 'Poppins', sans-serif; font-size: 14px; min-width: 150px;">
                <option value="todos">Todos los estados</option>
                <option value="pendiente">Pendiente</option>
                <option value="en_proceso">En proceso</option>
                <option value="completado">Completado</option>
                <option value="cancelado">Cancelado</option>
              </select>
              
              <select id="filtroUsuario" style="padding: 10px 15px; border: 2px solid #ddd; border-radius: 8px; font-family: 'Poppins', sans-serif; font-size: 14px; min-width: 150px;">
                <option value="todos">Todos los usuarios</option>
              </select>
              
              <input type="date" id="filtroFecha" style="padding: 10px 15px; border: 2px solid #ddd; border-radius: 8px; font-family: 'Poppins', sans-serif; font-size: 14px;">
              
              <button id="btnAplicarFiltro" style="padding: 10px 20px; background: #ff3b3b; color: white; border: none; border-radius: 8px; font-family: 'Poppins', sans-serif; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px;">
                <i class="fas fa-search"></i> Aplicar
              </button>
            </div>
          </div>
        </div>

        <!-- ===== TABLA DE PEDIDOS ===== -->
        <div class="contenedor-principal">
          <div style="background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border: 2px solid #ff3b3b;">
            <div style="padding: 20px; border-bottom: 3px solid #ff3b3b; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);">
              <h3 style="margin: 0; color: white; font-family: 'Bangers', cursive; font-size: 24px; display: flex; align-items: center; gap: 15px;">
                <i class="fas fa-list-alt"></i> LISTA DE PEDIDOS PERSONALIZADOS
              </h3>
            </div>
            
            <div style="overflow-x: auto;">
              <table id="tablaPedidos" style="width: 100%; border-collapse: collapse;">
                <thead>
                  <tr style="background: #f8f9fa;">
                    <th style="padding: 15px; text-align: left; font-family: 'Poppins', sans-serif; font-weight: 600; color: #1a1a2e; border-bottom: 2px solid #e9ecef;">ID</th>
                    <th style="padding: 15px; text-align: left; font-family: 'Poppins', sans-serif; font-weight: 600; color: #1a1a2e; border-bottom: 2px solid #e9ecef;">Cliente</th>
                    <th style="padding: 15px; text-align: left; font-family: 'Poppins', sans-serif; font-weight: 600; color: #1a1a2e; border-bottom: 2px solid #e9ecef;">Personaje</th>
                    <th style="padding: 15px; text-align: left; font-family: 'Poppins', sans-serif; font-weight: 600; color: #1a1a2e; border-bottom: 2px solid #e9ecef;">Tipo</th>
                    <th style="padding: 15px; text-align: left; font-family: 'Poppins', sans-serif; font-weight: 600; color: #1a1a2e; border-bottom: 2px solid #e9ecef;">Estado</th>
                    <th style="padding: 15px; text-align: left; font-family: 'Poppins', sans-serif; font-weight: 600; color: #1a1a2e; border-bottom: 2px solid #e9ecef;">Precio</th>
                    <th style="padding: 15px; text-align: left; font-family: 'Poppins', sans-serif; font-weight: 600; color: #1a1a2e; border-bottom: 2px solid #e9ecef;">Fecha</th>
                    <th style="padding: 15px; text-align: left; font-family: 'Poppins', sans-serif; font-weight: 600; color: #1a1a2e; border-bottom: 2px solid #e9ecef;">Acciones</th>
                  </tr>
                </thead>
                <tbody id="tbodyPedidos">
                  <!-- Las filas se llenar√°n con JavaScript -->
                </tbody>
              </table>
            </div>
            
            <div id="sinPedidos" style="display: none; text-align: center; padding: 60px 20px;">
              <i class="fas fa-clipboard-list" style="font-size: 60px; color: #ddd; margin-bottom: 20px;"></i>
              <h3 style="color: #666; font-family: 'Poppins', sans-serif; margin: 0 0 10px 0;">No hay pedidos personalizados</h3>
              <p style="color: #999; max-width: 400px; margin: 0 auto;">No se han realizado pedidos personalizados a√∫n.</p>
            </div>
          </div>
        </div>

        <!-- ===== MODAL DETALLE PEDIDO (ADMIN) ===== -->
        <div id="modalDetallePedido" class="modal-autor" style="display: none;">
          <div class="modal-autor-contenido">
            <button class="cerrar-modal" id="cerrarModalDetalle">
              <i class="fas fa-times"></i>
            </button>
            <div class="modal-autor-info" style="padding: 40px;">
              <h2 class="modal-autor-nombre" id="modalDetalleTitulo">Detalles del Pedido</h2>
              
              <div id="detallePedidoContenido">
                <!-- Los detalles se cargar√°n din√°micamente -->
              </div>
              
              <div style="display: flex; gap: 15px; margin-top: 30px; padding-top: 20px; border-top: 2px solid #eee;">
                <button id="btnCambiarEstado" style="flex: 1; padding: 15px; background: #2196F3; color: white; border: none; border-radius: 10px; font-family: 'Poppins', sans-serif; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; transition: all 0.3s ease;">
                  <i class="fas fa-edit"></i> Cambiar Estado
                </button>
                <button id="btnContactarCliente" style="flex: 1; padding: 15px; background: #4CAF50; color: white; border: none; border-radius: 10px; font-family: 'Poppins', sans-serif; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; transition: all 0.3s ease;">
                  <i class="fas fa-envelope"></i> Contactar Cliente
                </button>
                <button id="btnEliminarPedido" style="flex: 1; padding: 15px; background: #ff3b3b; color: white; border: none; border-radius: 10px; font-family: 'Poppins', sans-serif; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; transition: all 0.3s ease;">
                  <i class="fas fa-trash"></i> Eliminar Pedido
                </button>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    // ===== FUNCIONES PARA CLIENTES =====
    function configurarFormularioCliente() {
      // Configurar fecha m√≠nima para entrega
      const fechaEntregaInput = document.getElementById('fechaEntrega');
      if (fechaEntregaInput) {
        const fechaMinima = new Date();
        fechaMinima.setDate(fechaMinima.getDate() + 14);
        fechaEntregaInput.min = fechaMinima.toISOString().split('T')[0];
        
        const fechaDefecto = new Date();
        fechaDefecto.setDate(fechaDefecto.getDate() + 21);
        fechaEntregaInput.value = fechaDefecto.toISOString().split('T')[0];
      }

      // Cargar personajes en el selector
      const selectorPersonajes = document.getElementById('personaje');
      if (selectorPersonajes) {
        selectorPersonajes.innerHTML = '<option value="">Selecciona un personaje</option>';
        personajesDisponibles.forEach(personaje => {
          const option = document.createElement('option');
          option.value = personaje;
          option.textContent = personaje;
          selectorPersonajes.appendChild(option);
        });
      }

      // Configurar actualizaci√≥n de precio
      const inputsPrecio = ['tipoComic', 'formato', 'cantidad'];
      inputsPrecio.forEach(id => {
        const input = document.getElementById(id);
        if (input) {
          input.addEventListener('change', calcularPrecioCliente);
        }
      });

      // Configurar formulario
      const formularioPedido = document.getElementById('formularioPedido');
      if (formularioPedido) {
        formularioPedido.addEventListener('submit', function(e) {
          e.preventDefault();
          procesarPedidoPersonalizadoCliente();
        });
      }

      // Mostrar/ocultar advertencia de login
      const usuario = obtenerUsuarioActual();
      const loginWarning = document.getElementById('loginWarning');
      if (loginWarning) {
        loginWarning.style.display = usuario ? 'none' : 'block';
      }

      // Calcular precio inicial
      calcularPrecioCliente();
    }

    function calcularPrecioCliente() {
      const tipoComic = document.getElementById('tipoComic')?.value;
      const formato = document.getElementById('formato')?.value;
      const cantidad = parseInt(document.getElementById('cantidad')?.value) || 1;
      
      let precioBase = 0;
      
      switch(tipoComic) {
        case 'portada':
          precioBase = 50;
          break;
        case 'historieta':
          precioBase = 100;
          break;
        case 'novela':
          precioBase = 150;
          break;
        default:
          precioBase = 100;
      }
      
      switch(formato) {
        case 'digital':
          precioBase *= 0.8;
          break;
        case 'fisico':
          precioBase *= 1.2;
          break;
        case 'premium':
          precioBase *= 2;
          break;
      }
      
      const total = precioBase * cantidad;
      const precioElemento = document.getElementById('precioTotal');
      if (precioElemento) {
        precioElemento.textContent = `$${Math.round(total)}`;
      }
      
      return Math.round(total);
    }

    function procesarPedidoPersonalizadoCliente() {
      const usuario = obtenerUsuarioActual();
      if (!usuario) {
        mostrarNotificacion("Debes iniciar sesi√≥n para realizar un pedido personalizado.", "error");
        setTimeout(() => {
          window.location.href = "login.html";
        }, 1500);
        return;
      }
      
      const camposRequeridos = ['tipoComic', 'personaje', 'estilo', 'formato', 'cantidad', 'fechaEntrega', 'descripcion'];
      let formularioValido = true;
      
      camposRequeridos.forEach(campoId => {
        const campo = document.getElementById(campoId);
        if (!campo || !campo.value.trim()) {
          formularioValido = false;
          if (campo) campo.style.borderColor = '#ff0000';
        } else if (campo) {
          campo.style.borderColor = '#ddd';
        }
      });
      
      if (!formularioValido) {
        mostrarNotificacion("Por favor completa todos los campos requeridos antes de enviar.", "error");
        return;
      }
      
      const descripcion = document.getElementById('descripcion').value;
      if (descripcion.length < 20) {
        mostrarNotificacion("Por favor proporciona una descripci√≥n m√°s detallada de tu idea (m√≠nimo 20 caracteres).", "error");
        document.getElementById('descripcion').focus();
        return;
      }
      
      const datosPedido = {
        tipoComic: document.getElementById('tipoComic').value,
        personaje: document.getElementById('personaje').value,
        estilo: document.getElementById('estilo').value,
        formato: document.getElementById('formato').value,
        cantidad: parseInt(document.getElementById('cantidad').value),
        descripcion: document.getElementById('descripcion').value,
        fechaEntrega: document.getElementById('fechaEntrega').value
      };
      
      const precio = calcularPrecioCliente();
      
      // Usar la funci√≥n de funcionesUsuario.js
      if (typeof crearPedidoPersonalizadoParaCarrito === 'function') {
        const resultado = crearPedidoPersonalizadoParaCarrito(datosPedido);
        
        if (resultado) {
          mostrarNotificacion(`¬°Pedido personalizado agregado al carrito! Precio: $${precio}`, "success");
          
          // Limpiar formulario
          document.getElementById('formularioPedido').reset();
          
          // Recalcular precio
          calcularPrecioCliente();
          
          // Actualizar contador de carrito
          actualizarContadorCarrito();
        } else {
          mostrarNotificacion("Error al procesar el pedido. Intenta nuevamente.", "error");
        }
      } else {
        mostrarNotificacion("Error: No se pudo procesar el pedido. Recarga la p√°gina.", "error");
      }
    }

    // ===== FUNCIONES PARA ADMINISTRADOR =====
    function cargarTablaPedidos() {
      actualizarEstadisticas();
      cargarUsuariosEnFiltro();
      
      const tbody = document.getElementById('tbodyPedidos');
      const sinPedidos = document.getElementById('sinPedidos');
      
      if (!tbody || !sinPedidos) return;
      
      // Filtrar solo pedidos personalizados (no del carrito regular)
      const pedidosPersonalizados = pedidosDB.filter(pedido => 
        pedido.tipoComic || pedido.detalles || pedido.personaje
      );
      
      if (pedidosPersonalizados.length === 0) {
        tbody.style.display = 'none';
        sinPedidos.style.display = 'block';
        return;
      }
      
      tbody.style.display = 'table-row-group';
      sinPedidos.style.display = 'none';
      tbody.innerHTML = '';
      
      // Ordenar por fecha (m√°s reciente primero)
      pedidosPersonalizados.sort((a, b) => new Date(b.fechaPedido || b.fecha) - new Date(a.fechaPedido || a.fecha));
      
      pedidosPersonalizados.forEach(pedido => {
        const tr = document.createElement('tr');
        tr.style.borderBottom = '1px solid #eee';
        tr.style.cursor = 'pointer';
        tr.addEventListener('click', () => mostrarDetallePedidoAdmin(pedido));
        
        // Obtener datos del pedido
        const id = pedido.id || 'N/A';
        const usuario = pedido.usuario || pedido.nombreUsuario || 'Cliente desconocido';
        const personaje = pedido.personaje || pedido.detalles?.personaje || 'No especificado';
        const tipo = pedido.tipoComic || pedido.detalles?.tipoComic || 'Personalizado';
        const estado = pedido.estado || 'pendiente';
        const precio = pedido.precio || pedido.detalles?.precio || 0;
        const fecha = pedido.fechaPedido || pedido.fecha || new Date().toISOString();
        
        // Formatear fecha
        const fechaFormateada = new Date(fecha).toLocaleDateString('es-ES', {
          day: '2-digit',
          month: '2-digit',
          year: 'numeric'
        });
        
        // Color seg√∫n estado
        let colorEstado = '#666';
        let textoEstado = estado;
        
        switch(estado.toLowerCase()) {
          case 'pendiente':
          case 'en_carrito':
            colorEstado = '#ff9800';
            textoEstado = 'Pendiente';
            break;
          case 'en_proceso':
          case 'procesando':
            colorEstado = '#2196F3';
            textoEstado = 'En proceso';
            break;
          case 'completado':
          case 'completada':
            colorEstado = '#4CAF50';
            textoEstado = 'Completado';
            break;
          case 'cancelado':
            colorEstado = '#ff3b3b';
            textoEstado = 'Cancelado';
            break;
        }
        
        tr.innerHTML = `
          <td style="padding: 12px 15px; font-family: 'Poppins', sans-serif; font-weight: 600; color: #1a1a2e;">#${id}</td>
          <td style="padding: 12px 15px; font-family: 'Poppins', sans-serif; color: #333;">${usuario}</td>
          <td style="padding: 12px 15px; font-family: 'Poppins', sans-serif; color: #333;">${personaje}</td>
          <td style="padding: 12px 15px; font-family: 'Poppins', sans-serif; color: #333;">
            ${getTipoNombre(tipo)}
          </td>
          <td style="padding: 12px 15px; font-family: 'Poppins', sans-serif;">
            <span style="background: ${colorEstado}; color: white; padding: 5px 12px; border-radius: 15px; font-size: 12px; font-weight: 600;">
              ${textoEstado}
            </span>
          </td>
          <td style="padding: 12px 15px; font-family: 'Poppins', sans-serif; font-weight: 600; color: #ff3b3b;">$${precio}</td>
          <td style="padding: 12px 15px; font-family: 'Poppins', sans-serif; color: #666;">${fechaFormateada}</td>
          <td style="padding: 12px 15px;">
            <button class="btn-ver-pedido" data-id="${id}" style="padding: 6px 12px; background: #2196F3; color: white; border: none; border-radius: 5px; font-family: 'Poppins', sans-serif; font-size: 12px; cursor: pointer; display: flex; align-items: center; gap: 5px;">
              <i class="fas fa-eye"></i> Ver
            </button>
          </td>
        `;
        
        tbody.appendChild(tr);
      });
      
      // Configurar botones ver
      document.querySelectorAll('.btn-ver-pedido').forEach(btn => {
        btn.addEventListener('click', function(e) {
          e.stopPropagation();
          const pedidoId = this.getAttribute('data-id');
          const pedido = pedidosDB.find(p => p.id == pedidoId);
          if (pedido) {
            mostrarDetallePedidoAdmin(pedido);
          }
        });
      });
    }

    function actualizarEstadisticas() {
      const pedidosPersonalizados = pedidosDB.filter(pedido => 
        pedido.tipoComic || pedido.detalles || pedido.personaje
      );
      
      const totalPedidos = pedidosPersonalizados.length;
      const pedidosPendientes = pedidosPersonalizados.filter(p => 
        p.estado === 'pendiente' || p.estado === 'en_carrito' || !p.estado
      ).length;
      const pedidosCompletados = pedidosPersonalizados.filter(p => 
        p.estado === 'completado' || p.estado === 'completada'
      ).length;
      
      const ingresoTotal = pedidosPersonalizados.reduce((total, pedido) => {
        return total + (pedido.precio || pedido.detalles?.precio || 0);
      }, 0);
      
      // Actualizar elementos
      document.getElementById('totalPedidos').textContent = totalPedidos;
      document.getElementById('pedidosPendientes').textContent = pedidosPendientes;
      document.getElementById('pedidosCompletados').textContent = pedidosCompletados;
      document.getElementById('ingresoTotal').textContent = `$${ingresoTotal}`;
    }

    function cargarUsuariosEnFiltro() {
      const filtroUsuario = document.getElementById('filtroUsuario');
      if (!filtroUsuario) return;
      
      // Obtener usuarios √∫nicos de los pedidos
      const usuarios = [...new Set(pedidosDB.map(pedido => pedido.usuario || pedido.nombreUsuario).filter(Boolean))];
      
      // Limpiar opciones excepto la primera
      filtroUsuario.innerHTML = '<option value="todos">Todos los usuarios</option>';
      
      // Agregar opciones de usuarios
      usuarios.forEach(usuario => {
        const option = document.createElement('option');
        option.value = usuario;
        option.textContent = usuario;
        filtroUsuario.appendChild(option);
      });
    }

    function configurarEventosAdmin() {
      // Bot√≥n exportar pedidos
      document.getElementById('btnExportarPedidos').addEventListener('click', exportarPedidos);
      
      // Bot√≥n actualizar pedidos
      document.getElementById('btnActualizarPedidos').addEventListener('click', function() {
        pedidosDB = JSON.parse(localStorage.getItem("pedidosGlobales")) || [];
        cargarTablaPedidos();
        mostrarNotificacion("Lista de pedidos actualizada", "success");
      });
      
      // Bot√≥n aplicar filtro
      document.getElementById('btnAplicarFiltro').addEventListener('click', function() {
        // Implementar filtros aqu√≠
        mostrarNotificacion("Filtros aplicados", "info");
      });
      
      // Configurar modal de detalle
      const modal = document.getElementById('modalDetallePedido');
      const cerrarBtn = document.getElementById('cerrarModalDetalle');
      
      if (cerrarBtn) {
        cerrarBtn.addEventListener('click', function() {
          modal.style.display = 'none';
          document.body.style.overflow = 'auto';
        });
      }
      
      if (modal) {
        modal.addEventListener('click', function(e) {
          if (e.target === modal) {
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
          }
        });
      }
      
      // Configurar botones del modal
      document.getElementById('btnCambiarEstado')?.addEventListener('click', cambiarEstadoPedido);
      document.getElementById('btnContactarCliente')?.addEventListener('click', contactarCliente);
      document.getElementById('btnEliminarPedido')?.addEventListener('click', eliminarPedidoAdmin);
    }

    function mostrarDetallePedidoAdmin(pedido) {
      const modal = document.getElementById('modalDetallePedido');
      const contenido = document.getElementById('detallePedidoContenido');
      const titulo = document.getElementById('modalDetalleTitulo');
      
      if (!modal || !contenido || !titulo) return;
      
      // Obtener datos del pedido
      const id = pedido.id || 'N/A';
      const usuario = pedido.usuario || pedido.nombreUsuario || 'Cliente desconocido';
      const personaje = pedido.personaje || pedido.detalles?.personaje || 'No especificado';
      const tipo = pedido.tipoComic || pedido.detalles?.tipoComic || 'Personalizado';
      const estilo = pedido.estilo || pedido.detalles?.estilo || 'No especificado';
      const formato = pedido.formato || pedido.detalles?.formato || 'No especificado';
      const cantidad = pedido.cantidad || pedido.detalles?.cantidad || 1;
      const precio = pedido.precio || pedido.detalles?.precio || 0;
      const estado = pedido.estado || 'pendiente';
      const descripcion = pedido.descripcion || pedido.detalles?.descripcion || 'Sin descripci√≥n';
      const fechaPedido = pedido.fechaPedido || pedido.fecha || new Date().toISOString();
      const fechaEntrega = pedido.fechaEntrega || pedido.detalles?.fechaEntrega || 'No especificada';
      const numeroSeguimiento = pedido.numeroSeguimiento || 'No asignado';
      
      // Formatear fechas
      const fechaPedidoFormateada = new Date(fechaPedido).toLocaleDateString('es-ES', {
        day: '2-digit',
        month: 'long',
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
      
      const fechaEntregaFormateada = fechaEntrega !== 'No especificada' ? 
        new Date(fechaEntrega).toLocaleDateString('es-ES', {
          day: '2-digit',
          month: 'long',
          year: 'numeric'
        }) : 'No especificada';
      
      // Color seg√∫n estado
      let colorEstado = '#666';
      let textoEstado = estado;
      
      switch(estado.toLowerCase()) {
        case 'pendiente':
        case 'en_carrito':
          colorEstado = '#ff9800';
          textoEstado = 'Pendiente';
          break;
        case 'en_proceso':
        case 'procesando':
          colorEstado = '#2196F3';
          textoEstado = 'En proceso';
          break;
        case 'completado':
        case 'completada':
          colorEstado = '#4CAF50';
          textoEstado = 'Completado';
          break;
        case 'cancelado':
          colorEstado = '#ff3b3b';
          textoEstado = 'Cancelado';
          break;
      }
      
      // Guardar ID del pedido en un atributo del modal
      modal.setAttribute('data-pedido-id', id);
      
      titulo.textContent = `Pedido #${id} - ${personaje}`;
      
      contenido.innerHTML = `
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
          <div style="background: #f8f9fa; border-radius: 10px; padding: 20px;">
            <h4 style="margin: 0 0 15px 0; color: #1a1a2e; font-family: 'Poppins', sans-serif; display: flex; align-items: center; gap: 10px;">
              <i class="fas fa-info-circle"></i> Informaci√≥n del Pedido
            </h4>
            <p><strong>ID:</strong> #${id}</p>
            <p><strong>Cliente:</strong> ${usuario}</p>
            <p><strong>Personaje:</strong> ${personaje}</p>
            <p><strong>Tipo:</strong> ${getTipoNombre(tipo)}</p>
            <p><strong>Estilo:</strong> ${getEstiloNombre(estilo)}</p>
            <p><strong>Formato:</strong> ${getFormatoNombre(formato)}</p>
            <p><strong>Cantidad:</strong> ${cantidad}</p>
          </div>
          
          <div style="background: #f8f9fa; border-radius: 10px; padding: 20px;">
            <h4 style="margin: 0 0 15px 0; color: #1a1a2e; font-family: 'Poppins', sans-serif; display: flex; align-items: center; gap: 10px;">
              <i class="fas fa-calendar-alt"></i> Fechas y Estado
            </h4>
            <p><strong>Fecha de pedido:</strong> ${fechaPedidoFormateada}</p>
            <p><strong>Fecha de entrega estimada:</strong> ${fechaEntregaFormateada}</p>
            <p><strong>N√∫mero de seguimiento:</strong> ${numeroSeguimiento}</p>
            <p><strong>Estado actual:</strong> 
              <span style="background: ${colorEstado}; color: white; padding: 5px 12px; border-radius: 15px; font-size: 12px; font-weight: 600; margin-left: 10px;">
                ${textoEstado}
              </span>
            </p>
            <p><strong>Precio total:</strong> <span style="color: #ff3b3b; font-weight: bold; font-size: 18px;">$${precio}</span></p>
          </div>
        </div>
        
        <div style="background: #f8f9fa; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
          <h4 style="margin: 0 0 15px 0; color: #1a1a2e; font-family: 'Poppins', sans-serif; display: flex; align-items: center; gap: 10px;">
            <i class="fas fa-edit"></i> Descripci√≥n del Pedido
          </h4>
          <p style="white-space: pre-wrap; line-height: 1.6; background: white; padding: 15px; border-radius: 8px; border: 1px solid #ddd;">${descripcion}</p>
        </div>
        
        <div style="background: #f8f9fa; border-radius: 10px; padding: 20px;">
          <h4 style="margin: 0 0 15px 0; color: #1a1a2e; font-family: 'Poppins', sans-serif; display: flex; align-items: center; gap: 10px;">
            <i class="fas fa-history"></i> Historial de Estados
          </h4>
          <div style="background: white; padding: 15px; border-radius: 8px; border: 1px solid #ddd;">
            <p>‚Ä¢ ${fechaPedidoFormateada} - Pedido creado</p>
            ${estado !== 'pendiente' ? `<p>‚Ä¢ [Fecha] - Estado cambiado a: ${textoEstado}</p>` : ''}
            <p style="color: #666; font-style: italic;">No hay m√°s registros en el historial</p>
          </div>
        </div>
      `;
      
      modal.style.display = 'flex';
      document.body.style.overflow = 'hidden';
    }

    function cambiarEstadoPedido() {
      const modal = document.getElementById('modalDetallePedido');
      const pedidoId = modal.getAttribute('data-pedido-id');
      
      if (!pedidoId) return;
      
      const pedidoIndex = pedidosDB.findIndex(p => p.id == pedidoId);
      if (pedidoIndex === -1) return;
      
      const estados = ['pendiente', 'en_proceso', 'completado', 'cancelado'];
      const nombresEstados = ['Pendiente', 'En proceso', 'Completado', 'Cancelado'];
      const coloresEstados = ['#ff9800', '#2196F3', '#4CAF50', '#ff3b3b'];
      
      const estadoActual = pedidosDB[pedidoIndex].estado || 'pendiente';
      let estadoIndex = estados.indexOf(estadoActual.toLowerCase());
      
      if (estadoIndex === -1) estadoIndex = 0;
      
      const nuevoEstadoIndex = (estadoIndex + 1) % estados.length;
      const nuevoEstado = estados[nuevoEstadoIndex];
      
      // Actualizar estado
      pedidosDB[pedidoIndex].estado = nuevoEstado;
      
      // Guardar en localStorage
      localStorage.setItem("pedidosGlobales", JSON.stringify(pedidosDB));
      
      // Actualizar la tabla
      cargarTablaPedidos();
      
      // Actualizar el modal
      mostrarDetallePedidoAdmin(pedidosDB[pedidoIndex]);
      
      mostrarNotificacion(`Estado cambiado a: ${nombresEstados[nuevoEstadoIndex]}`, "success");
    }

    function contactarCliente() {
      const modal = document.getElementById('modalDetallePedido');
      const pedidoId = modal.getAttribute('data-pedido-id');
      
      if (!pedidoId) return;
      
      const pedido = pedidosDB.find(p => p.id == pedidoId);
      if (!pedido) return;
      
      const usuario = pedido.usuario || pedido.nombreUsuario;
      const correo = obtenerCorreoUsuario(usuario);
      
      if (correo) {
        const asunto = `Galaxy Comics - Pedido Personalizado #${pedidoId}`;
        const cuerpo = `Hola ${usuario},\n\nReferente a tu pedido personalizado de ${pedido.personaje || 'c√≥mic personalizado'} (ID: #${pedidoId}).\n\nEstado actual: ${pedido.estado || 'pendiente'}\n\n¬øPodr√≠as proporcionarnos m√°s detalles o aclarar alguna duda sobre tu pedido?\n\nSaludos,\nEquipo Galaxy Comics`;
        
        window.open(`mailto:${correo}?subject=${encodeURIComponent(asunto)}&body=${encodeURIComponent(cuerpo)}`, '_blank');
        mostrarNotificacion(`Redirigiendo a correo para ${usuario}`, "info");
      } else {
        mostrarNotificacion("No se encontr√≥ el correo del usuario", "error");
      }
    }

    function obtenerCorreoUsuario(usuarioNombre) {
      const usuarios = JSON.parse(localStorage.getItem("usuarios")) || [];
      const usuario = usuarios.find(u => u.usuario === usuarioNombre);
      return usuario ? usuario.correo : null;
    }

    function eliminarPedidoAdmin() {
      const modal = document.getElementById('modalDetallePedido');
      const pedidoId = modal.getAttribute('data-pedido-id');
      
      if (!pedidoId) return;
      
      const pedido = pedidosDB.find(p => p.id == pedidoId);
      if (!pedido) return;
      
      if (!confirm(`¬øEst√°s seguro de que deseas eliminar el pedido #${pedidoId} de ${pedido.usuario}? Esta acci√≥n no se puede deshacer.`)) {
        return;
      }
      
      // Eliminar de la base de datos
      pedidosDB = pedidosDB.filter(p => p.id != pedidoId);
      
      // Guardar en localStorage
      localStorage.setItem("pedidosGlobales", JSON.stringify(pedidosDB));
      
      // Cerrar modal
      modal.style.display = 'none';
      document.body.style.overflow = 'auto';
      
      // Actualizar tabla
      cargarTablaPedidos();
      
      mostrarNotificacion(`Pedido #${pedidoId} eliminado correctamente`, "success");
    }

    function exportarPedidos() {
      const pedidosPersonalizados = pedidosDB.filter(pedido => 
        pedido.tipoComic || pedido.detalles || pedido.personaje
      );
      
      if (pedidosPersonalizados.length === 0) {
        mostrarNotificacion("No hay pedidos para exportar", "warning");
        return;
      }
      
      const datos = JSON.stringify(pedidosPersonalizados, null, 2);
      const blob = new Blob([datos], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      
      const a = document.createElement('a');
      a.href = url;
      a.download = `pedidos-personalizados-${new Date().toISOString().split('T')[0]}.json`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      
      URL.revokeObjectURL(url);
      
      mostrarNotificacion("Pedidos exportados correctamente", "success");
    }

    // ===== FUNCIONES AUXILIARES =====
    function getTipoNombre(tipo) {
      const tipos = {
        'portada': 'Portada Personalizada',
        'historieta': 'Historieta Corta',
        'novela': 'Novela Gr√°fica'
      };
      return tipos[tipo] || 'Personalizado';
    }
    
    function getEstiloNombre(estilo) {
      const estilos = {
        'clasico': 'Cl√°sico',
        'moderno': 'Moderno',
        'manga': 'Manga/Anime',
        'realista': 'Realista',
        'cartoon': 'Cartoon'
      };
      return estilos[estilo] || 'Personalizado';
    }
    
    function getFormatoNombre(formato) {
      const formatos = {
        'digital': 'Digital (PDF)',
        'fisico': 'F√≠sico Est√°ndar',
        'premium': 'F√≠sico Premium'
      };
      return formatos[formato] || 'No especificado';
    }

    function obtenerUsuarioActual() {
      const usuarioStr = localStorage.getItem("usuarioActual");
      return usuarioStr ? JSON.parse(usuarioStr) : null;
    }

    function mostrarNotificacion(mensaje, tipo = "info") {
      const notificacion = document.createElement('div');
      const iconos = {
        success: "fa-check-circle",
        error: "fa-exclamation-circle",
        warning: "fa-exclamation-triangle",
        info: "fa-info-circle"
      };
      
      notificacion.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${tipo === "success" ? "#4CAF50" : 
                     tipo === "error" ? "#ff3b3b" : 
                     tipo === "warning" ? "#ff9800" : "#2196F3"};
        color: white;
        padding: 15px 25px;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        z-index: 10000;
        font-family: 'Poppins', sans-serif;
        display: flex;
        align-items: center;
        gap: 15px;
        animation: slideIn 0.5s ease;
        max-width: 400px;
      `;
      
      notificacion.innerHTML = `
        <i class="fas ${iconos[tipo] || iconos.info}" style="font-size: 24px;"></i>
        <span>${mensaje}</span>
      `;
      
      document.body.appendChild(notificacion);
      
      setTimeout(() => {
        notificacion.style.animation = 'slideOut 0.5s ease';
        setTimeout(() => notificacion.remove(), 500);
      }, 3000);
    }

    function actualizarContadorCarrito() {
      const usuarioActual = obtenerUsuarioActual();
      let totalItems = 0;
      
      if (usuarioActual && usuarioActual.carrito) {
        totalItems = usuarioActual.carrito.reduce((total, item) => total + item.cantidad, 0);
      }
      
      const carritoContador = document.getElementById('carritoContador');
      const navCarritoContador = document.getElementById('navCarritoContador');
      
      if (carritoContador) {
        carritoContador.textContent = totalItems;
        carritoContador.style.display = totalItems > 0 ? 'flex' : 'none';
      }
      
      if (navCarritoContador) {
        navCarritoContador.textContent = totalItems;
        navCarritoContador.style.display = totalItems > 0 ? 'inline-block' : 'none';
      }
    }

    // Agregar estilos de animaci√≥n
    if (!document.querySelector('#estilosAnimacionPedidos')) {
      const estiloAnimaciones = document.createElement('style');
      estiloAnimaciones.id = 'estilosAnimacionPedidos';
      estiloAnimaciones.textContent = `
        @keyframes slideIn {
          from { transform: translateX(100%); opacity: 0; }
          to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOut {
          from { transform: translateX(0); opacity: 1; }
          to { transform: translateX(100%); opacity: 0; }
        }
        
        #tbodyPedidos tr:hover {
          background-color: #f5f5f5;
        }
        
        .modal-autor {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: rgba(0, 0, 0, 0.9);
          z-index: 5000;
          display: none;
          justify-content: center;
          align-items: center;
          padding: 20px;
          animation: fadeIn 0.3s ease;
          overflow-y: auto;
        }
        
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
      `;
      document.head.appendChild(estiloAnimaciones);
    }
  </script>

<!-- ===== FOOTER C√ìMIC ===== -->
<footer>
  <div class="footer-comic">
    <div class="footer-borde-rojo"></div>
    <div class="footer-contenido">
      <img src="img/logo.png" alt="Footer Image" class="footer-img-comic">
      <p class="footer-texto-comic">
        Roldan Ortega Andrea Lizbeth, 5-I, Materia: Construye Aplicaciones Web
      </p>
      <div class="footer-detalles">
        <span class="puntos-rojos">‚Ä¢‚Ä¢‚Ä¢</span>
        <span class="icono-corazon">‚ù§Ô∏è</span>
      </div>
    </div>
  </div>
</footer>

</body>
</html>